require 'digest/md5'

class Exploit < EvasionDbConnection
  has_many :idmef_events, :dependent=>:destroy
  has_many :packets, :dependent=>:destroy
  has_many :exploit_options, :dependent=>:destroy

  def self.table_name
    "exploits"
  end

  def self.find_or_create_by_name_and_options(name,options)
    hash = Digest::MD5.hexdigest(options.to_s)
    exploit = self.find_or_create_by_name_and_options_hash(name,hash)
    if exploit.exploit_options.size == 0
      exploit.options_hash = hash
      options.each do |k,v|
        exploit.exploit_options << ExploitOption.new(:option_key=>k,:option_value=>v)
      end
      exploit.save
    end
    exploit
  end
end
